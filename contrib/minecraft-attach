#!/bin/bash

set -o pipefail

SERVER_NAME=$1
TMUX_SOCKET=/var/lib/minecraft/tmux/$1

if [[ ! -e "$TMUX_SOCKET" ]]; then
	echo "[1;31merror:[m Unknown server name '$SERVER_NAME'. Running servers:" >&2
	any=0
	for i in "/var/lib/minecraft/tmux/"*; do
		echo " - $i" >&2
		any=1
	done
	[[ $any == 1 ]] || echo " - (none)"
	exit 1
fi

exec runuser -u minecraft -- tmux -S "$TMUX_SOCKET" attach-session
