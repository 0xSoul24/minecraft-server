#!/bin/bash

set -o pipefail

SERVER_NAME=$1
TMUX_SOCKET="/run/minecraft/tmux-$1"

if [[ ! -e "$TMUX_SOCKET" ]]; then
	echo "[1;31merror:[m Unknown server name '$SERVER_NAME'. Available servers:" >&2
	any=0
	for i in "/run/minecraft/tmux-"*; do
		echo " - ${i#*tmux-}" >&2
		any=1
	done
	[[ $any == 1 ]] || echo " - (none)"
	exit 1
fi

exec runuser -u minecraft -- tmux -S "$TMUX_SOCKET" attach-session
